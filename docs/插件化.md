# 插件化

插件化技术最初源于免安装运行 apk 的想法，这个免安装的 apk 就可以理解为插件，而支持插件的 app 我们一般叫宿主。

#### 插件化解决的问题

* app功能模块越来越多，体积越来越大
* 模块之间耦合度高，协同开发沟通成本太高
* app方法数超过65535，app占用内存越来越大
* 应用之间相互调用



#### 类的生命周期

![image](..\images\类的生命周期.png)

在加载阶段，虚拟机主要完成三件事：

　　1.通过一个类的全限定名来获取定义此类的二进制字节流。

　　2.将这个字节流所代表的静态存储结构转化为方法区域的运行时数据结构。

　　3.在Java堆中生成一个代表这个类的Class对象，作为方法区域数据的访问入口



#### 插件化流程

1. 创建插件的 DexClassLoader 类加载器，然后通过反射获取插件的 dexElements 值
2. 获取宿主的 PathClassLoader 类加载器，然后通过反射获取宿主的 dexElements 值
3. 合并宿主的 dexElements 与 插件的 dexElements，生成新的 Element[]
4. 最后通过反射将新的 Element[] 赋值给宿主的 dexElements 

![image](..\images\插件化流程.png)

