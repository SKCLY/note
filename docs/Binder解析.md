# Binder解析

#### Android中的IPC方式(android中跨进程通信的方式有几种？)

1. Bundle。四大组件都支持在Intent中传递Bundle的数据，由于Bundle实现了Parcelable，故传输的数据必须是能够被序列化，比如基本数据类型，实现了Parcelable接口的对象，实现了Serializable接口的对象，由于是使用intent传输一般来说传递数据大小不能超过1M。**优点：**使用方便，传输数据快。
2. 文件共享。两个进程通过读/写同一个文件进行数据交换。**优点：**简单易用。**限制：**由于Android基于Linux，对文件读/写没有限制，当出现并发情况时可能出现数据出错，并且无法做到进程间即时通信。 **适用场景：**无并发情形，数据简单交换实时性不高。
3. Messenger。Messenger是一种轻量级的IPC方案，底层实现是AIDL，可以在不同进程中传递Message对象。**优点：**支持一对多串行通信，支持实时通信。**缺点：**不支持高并发场景，通过Message传输数据，只能传输Bundle支持的数据类型
4. AIDL。**优点：**功能强大，支持一对多并发通信，支持实时通信。**缺点：**使用复杂，需要自己处理线程同步。具体使用需要详细解释
5. ContentProvider。**优点：**在数据源访问方面功能强大，支持一对多并发数据共享，可通过Call方便扩展其他操作。**缺点：**可能理解为受约束的AIDL，主要提供CRUD操作。
6. Socket。**优点：**功能强大，可能通过网络传输字节流，支持一对多并发实时通信。**缺点：**实现细节烦琐，需要和服务器长连接比较消耗服务器性能。

#### 使用多进程开发的优点？

1. 给APP开辟更多的内存。安卓虚拟机是给每一个进程分配一份内存，多进程就可以得到更多的内存
2. 风险隔离。风险高的操作放在单独进程中，可以保证主应用的正常运行

#### 什么是Binder？(四大组件底层通信机制是什么？)

Binder是android中一种跨进程通信方式，Binder是ServiceManager连接各种Manager(ActivityManager)和相应ManagerService的桥梁

#### Binder有什么优点？(为什么Android选择Binder做为组件通信机制？)

跨进程通信中，只有socket支持c/s的通信方式，但是socket存在如下两点问题： 

1. socket的消息队列和管道采用存储/转发方式，数据先从发送方缓存区拷贝到内核开辟的缓存中，再从缓存中拷贝到接收方缓存区，需要拷贝两次，导致传输效率低。
2. socket通信接收方为了能分辨发送方的身份，需要在传输过程中加入发送方的UID和PID，这样容易被恶意拦截和修改，还有socket链接是开放的，只需要知道对方IP地址就可以接入。socked通信会有安全性问题

所以android开发了Binder通信方式，解决如上两点问题

Binder基于Client-Server通信模式，传输过程只需一次拷贝，为发送发添加UID/PID身份，既支持实名Binder也支持匿名Binder，安全性高。

#### Binder通信原理详细说一下？

内存被操作系统划分成两块：用户空间和内核空间，用户空间是用户程序代码运行的地方，内核空间是内核代码运行的地方，内核空间是共享的。

#### Binder如何做到只进行一次拷贝？

Binder通信时， Binder驱动将**接收方进程**虚拟地址空间与**内核**虚拟地址空间（也就是匿名共享内存Ashmem)共同**映射到同一块物理内存空间**，然后将发送方的数据【拷贝】到内核， 这样就只需一次拷贝即实现进程通信。匿名共享内存不限制大小，但系统的Binder驱动为每一个进程只分配了4M内存缓冲区， 而上层给每个Binder限制8k-1M，故Binder传递的数量最大只有1M。

#### 为什么Intent不能传递大数据？(Binder传递数据大小限制是多少？)

Intent携带信息的大小其实是受Binder限制。数据以Parcel对象的形式存放在Binder传递缓存中。如果数据或返回值比传递buffer大，则此次传递调用失败并抛出TransactionTooLargeException异常。Binder传递缓存有一个限定大小，通常是1Mb。

系统的Binder驱动为每一个进程只分配了4M内存缓冲区， 而上层给每个Binder限制8k-1M，故Binder传递的数量最大只有1M。

#### MMAP原理讲解(Binder接收方和内核共享同一块物理内存的原理是什么？)

Linux通过将一个虚拟内存区域与一个磁盘上的对象关联起来，以初始化这个虚拟内存区域的内容，这个过程称为内存映射。实现这们的映射关系后，就可以采用指针的方式读写操作这段内存，且系统会自动回写到对应的磁盘上。

#### 描述AIDL生成的Java类细节

